<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <!-- Changeset 1: Создание таблицы "book" -->
    <changeSet id="1" author="yourname">
        <createTable tableName="book">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="title" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="author" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="isbn" type="VARCHAR(50)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <!-- Создание индекса по колонке isbn -->
        <createIndex indexName="idx_book_isbn" tableName="book">
            <column name="isbn"/>
        </createIndex>
    </changeSet>

    <!-- Changeset 2: Создание таблицы "client" -->
    <changeSet id="2" author="yourname">
        <createTable tableName="client">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="full_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="birth_date" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Changeset 3: Создание таблицы "book_order" для взятия книги на прочтение -->
    <changeSet id="3" author="yourname">
        <createTable tableName="book_order">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="client_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="book_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="order_date" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!-- Добавление внешних ключей -->
        <addForeignKeyConstraint baseTableName="book_order" baseColumnNames="client_id"
                                 referencedTableName="client" referencedColumnNames="id"
                                 constraintName="fk_book_order_client"/>
        <addForeignKeyConstraint baseTableName="book_order" baseColumnNames="book_id"
                                 referencedTableName="book" referencedColumnNames="id"
                                 constraintName="fk_book_order_book"/>
        <!-- Индекс по дате взятия книги -->
        <createIndex indexName="idx_book_order_date" tableName="book_order">
            <column name="order_date"/>
        </createIndex>
    </changeSet>

    <!-- Здесь можно добавлять дальнейшие changeset'ы для обновлений схемы -->

</databaseChangeLog>
